<template>
  <header class="table-header">
    <h2 class="table-title">Extracted Metadata</h2>
  </header>

  <v-divider class="mb-4" />

  <v-data-table
    :headers="headers"
    :items="items"
    item-key="id"
    class="container-table"
  >
    <!-- колонка name -->
    <template #item.name="{ item }">
      <div class="table-name">
        <v-chip class="table-chip" size="small" label>{{ item.name }}</v-chip>
      </div>
    </template>

    <!-- колонка value -->
    <template #item.value="{ item }">
      <div class="table-value" :title="item.value">
        {{ item.value }}
      </div>
    </template>
  </v-data-table>

  <v-snackbar
    class="snackbar"
    :color="snackbarColor"
    v-model="snackbar"
    location="top"
    elevation="0"
    transition="slide-y-transition"
  >
    <div class="snackbar-content">
      <span>{{ snackbarText }}</span>
    </div>
  </v-snackbar>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import type { MetaType } from '@/types/Panel/Metadata/metadata.types'
import { getMetadata } from '@/composable/PanelContent/panelcontent.request'

const snackbar = ref(false)
const snackbarColor = ref<'success' | 'error'>('success')
const snackbarText = ref('')

const items = ref<MetaType[]>([])

const headers = [
  { title: 'Name', key: 'name', sortable: true },
  { title: 'Value', key: 'value', sortable: false },
]

onMounted(async () => {
  try {
    const response = await getMetadata()
    // ожидаем массив от бэка
    items.value = response
  } catch (err) {
    console.error('Failed to load metadata:', err)
    snackbar.value = true
    snackbarColor.value = 'error'
    snackbarText.value = 'An error has occurred - data not loaded. Please reload the page.'
  }
})
</script>

<style scoped>
.container-table {
  border: 1px solid #e9edf2;
  border-radius: 10px;
}

.table-header {
  margin-bottom: 16px;
}

.table-title {
  font-weight: 800;
  font-size: 22px;
  color: #0a7cff;
  letter-spacing: 0.5px;
}

.table-name .table-chip {
  font-weight: 700;
  border-radius: 8px;
  background: #eef5ff;
  color: #0a7cff;
  letter-spacing: 1px;
}

.table-value {
  overflow: hidden;
  text-overflow: ellipsis;
  color: #1f2937;
  font-weight: 600;
  letter-spacing: 0.5px;
}
</style>
